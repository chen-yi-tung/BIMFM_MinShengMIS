@{
    ViewBag.Title = "新增入庫";
}
<style>
    .datatable-input-area {
        display: flex;
        flex-direction: column;
        max-width: 1090px;
        margin: auto;
        max-height: calc(100vh - var(--navbar-height));
        max-height: calc(100vh - var(--navbar-height));
        gap: 1rem;
    }
    .edit-area {
        display: flex;
        justify-content: left;
        align-items: start;
    }
    .paths-btn {
        width: 40px;
        height: 40px;
        background: #44BCC2;
        color: #fff;
        border-radius: 5px;
        border: 0;
        opacity: 1;
        transition: all .3s;
    }
</style>

<h2>@ViewBag.Title</h2>

<section class="datatable-input-area mt-3">
    <div class="edit-area edit-area-middle">
        <div class="d-flex">
            <form class="form" enctype="multipart/form-data">
                <div class="form-group d-lg-contents">
                    <label for="POSN">採購單號</label>
                    <input class="form-control" type="text" id="POSN" name="POSN">
                </div>
            </form>
            <div style="padding:18px 0; margin-left:23px">
                <button class="paths-btn" id="path-search" data-bs-toggle="modal" data-bs-target="#DatagridModal-Repair"><i class="icon-search"></i></button>
            </div>
        </div>
        <div class="datatable datatable-fill mt-5 d-none">
            <div class="datatable-body">
                <table class="datatable-table" id="EquipmentMaintainItem">
                </table>
            </div>
        </div>
    </div>
</section>
<div class="datatable datatable-fill mt-5">
            <div class="datatable-body">
                <table class="datatable-table" id="aaa">
                </table>
            </div>
        </div>

<script src="/Scripts/datatable.js"></script>
<script>

    const SIRSN = '@ViewBag.id';
    //let apiUrl = '@Url.Action("ReadBody", "Report_Management")' + `/${SIRSN}`;
    let apiUrl = null;

    const GridOptions = {
        thead: true,
        columns: [
            {
                id: "_checkbox",
                title: "",
                width: "6%",
                formatter: (data, row, index) => {
                    return `<input class="form-check-input check-item" type="radio" name="checkbox-POSN" id="checkbox-${index}"/>`
                }
            },
            { id: "POState", title: "狀態" },
            { id: "POSN", title: "採購單號" },
            { id: "PurchaseName", title: "採購人員" },
            { id: "PurchaseDataTime", title: "採購日期" },
            { id: "MFRName", title: "廠商" },
            { id: "Accepter", title: "驗收人員" },
            { id: "AcceptanceDateTime", title: "驗收日期" },
            { id: "InquiryName", title: "詢價人員" }
        ]
    }
    const GridOptions2 = {
        thead: true,
        columns: [
            {
                id: "_checkbox",
                title: "",
                width: "6%",
                formatter: (data, row, index) => {
                    return `<input class="form-check-input check-item" type="radio" name="checkbox-POSN" id="checkbox-${index}"/>`
                }
            },
            { id: "Kind", title: "狀態" },
            { id: "ItemName", title: "採購單號" }
        ]
    }
    const fakeData = {

        EquipmentMaintainItem: [
            {
                POState:"部分驗收",
                POSN: "PO23050201",
                PurchaseName:"王小明",
                PurchaseDataTime:"2023/05/02",
                MFRName:"A廠商",
                Accepter:"陳大明",
                AcceptanceDateTime:"2023/05/06",
                InquiryName:"黃中明",
                sss:[
                    {
                        Kind:"備料",
                        ItemName:"藥劑-1"
                    }
                ]
            },
            {
                POState:"部分驗收",
                POSN: "PO23050201",
                PurchaseName:"王小明",
                PurchaseDataTime:"2023/05/02",
                MFRName:"A廠商",
                Accepter:"陳大明",
                AcceptanceDateTime:"2023/05/06",
                InquiryName:"黃中明" ,
                sss:[
                    {
                        Kind:"備料",
                        ItemName:"藥劑-1"
                    }
                ]
            },
            {
                POState:"部分驗收",
                POSN: "PO23050201",
                PurchaseName:"王小明",
                PurchaseDataTime:"2023/05/02",
                MFRName:"A廠商",
                Accepter:"陳大明",
                AcceptanceDateTime:"2023/05/06",
                InquiryName:"黃中明" ,
                sss:[
                    {
                        Kind:"備料",
                        ItemName:"藥劑-1"
                    }
                ]
            }
        ]
    }

    $(async function () {
        addButtonEvent();
    })

    function addButtonEvent() {
        $("#path-search").click(function () {
            //e.preventDefault();
            console.log("onclick path-search");
            $(".datatable.datatable-fill.mt-5").removeClass("d-none");
        })
    }
    
    function readData(url = null) {

        url == null ? onSuccess(fakeData) :
            $.ajax({
                url: url,
                type: "GET",
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: onSuccess,
                error: onError
            })

        function onSuccess(res) {
            console.log(res);
            $("#EquipmentMaintainItem").append(createTableGrid(res.EquipmentMaintainItem, GridOptions))
            $("#aaa").append(createTableGrid(res.EquipmentMaintainItem[0].sss, GridOptions2))
        }
        function onError(res) {
            console.log(res);
        }
    }

    window.onload = function () {

        readData(apiUrl);
    }

</script>
