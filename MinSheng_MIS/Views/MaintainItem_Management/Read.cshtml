@{
    ViewBag.Title = "保養項目詳情";
}
@section styles {
    <script src="/Scripts/datatable.js" defer></script>
}
<h2>@ViewBag.Title</h2>

<div class="datatable datatable-small mt-5">
    <div class="datatable-body">
        <table class="datatable-table" id="MaintainItemInfo"></table>
    </div>
</div>

<div class="datatable datatable-small-grid mt-5">
    <div class="datatable-body">
        <table class="datatable-table" id="EquipmentMaintainItem">
        </table>
    </div>
</div>

@section scripts {
    <script>
        const MISN = '@ViewBag.id'
        const apiUrl = `@Url.Action("ReadBody", "MaintainItem_Management")?MISN=${MISN}`;

        const SerializedName = [
            { text: "系統別", value: "System" },
            { text: "子系統別", value: "SubSystem" },
            { text: "設備名稱", value: "EName" },
            { text: "項目名稱", value: "MIName" },
            { text: "保養週期單位", value: "Unit" },
            { text: "保養週期", value: "Period" },
        ]

        const GridOptions = {
            thead: true,
            columns: [
                { id: "ESN", title: "設備編號", width: "36%" },
                { id: "Unit", title: "保養週期單位", width: "36%" },
                { id: "Period", title: "保養週期", width: "28%" },
            ]
        }

        const fakeData = {
            System: "前處理",
            SubSystem: "前處理",
            EName: "除物皮帶輸送機",
            MIName: "軸承潤滑",
            Unit: "月",
            Period: "1",
            EquipmentMaintainItem: [
                {
                    ESN: "E00001",
                    Unit: "月",
                    Period: "1",
                },
                {
                    ESN: "E00002",
                    Unit: "天",
                    Period: "7",
                },
                {
                    ESN: "E00003",
                    Unit: "月",
                    Period: "2",
                },
                {
                    ESN: "E00004",
                    Unit: "月",
                    Period: "2",
                },
            ]
        }

        function readData(url = null) {

            url == null ? onSuccess(fakeData) :   //fakeData
                $.ajax({
                    url: url,
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: onSuccess,
                    error: onError
                })

            function onSuccess(res) {
                console.log(res);
                $("#MaintainItemInfo").append(createTableInner(res, SerializedName));
                if (res.EquipmentMaintainItem) {
                    $("#EquipmentMaintainItem").append(createTableGrid(res.EquipmentMaintainItem, GridOptions))
                }
                else {
                    $("#EquipmentMaintainItem").parents(".datatable").remove();
                }
            }
            function onError(res) {
                console.log(res);
            }
        }

        window.onload = function () {
            readData(apiUrl);
        }
    </script>
}
