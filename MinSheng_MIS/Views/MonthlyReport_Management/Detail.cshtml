@{
    ViewBag.Title = "月報詳情";
}
@section styles {
    <link rel="stylesheet" href="/Content/samplepath.css">
    <script src="/Scripts/datatable.js" defer></script>
}

<h2>@ViewBag.Title</h2>

<section>
    <div class="info-area">
        <div class="datatable datatable-small">
            <div class="datatable-body">
                <table class="datatable-table"></table>
            </div>
        </div>
    </div>
</section>

@section scripts {
    <script>
        const MRSN = '@ViewBag.id';
        let apiUrl = '@Url.Action("ReadBody", "MonthlyReport_Management")' + `/${MRSN}`;

        const fakeData = {
            MRSN: "1",
            ReportTitle: "2023-5月月報",
            UploadUserName: "王大明",
            UploadDateTime: "2023/5/22",
            ReportContent: "OOXX",
            YearMonth: "2023-05",
            FilePath: "/Files/a.pdf"
        }

        const sn = [
            {
                text: "年月份", value: "YearMonth", formatter: function (v) {
                    const [ADYear, month] = v.split('-');
                    const rocYear = parseInt(ADYear) - 1911;
                    return rocYear + "-" + month;
                }
            },
            { text: "月報名稱", value: "ReportTitle" },
            { text: "上傳者", value: "UploadUserName" },
            { text: "上傳日期", value: "UploadDateTime", type: "Date" },
            { text: "內容說明", value: "ReportContent", pre: true },
            { text: "月報檔案", value: "FilePath", url: true },
        ]


        $(function () {
            addButtonEvent();
            readData(apiUrl);
        })

        function readData(url = null) {

            url == null ? onSuccess(fakeData) :
                $.ajax({
                    url: url,
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: onSuccess,
                    error: onError
                })

            async function onSuccess(res) {
                console.log(res);
                $(".datatable-table").append(createTableInner(res, sn))
            }
            function onError(res) {
                console.log(res);
            }
        }

        function addButtonEvent() {
            $("#back").click(function () {
                history.back();
            })
        }
    </script>
}
