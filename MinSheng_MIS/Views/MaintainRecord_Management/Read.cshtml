@{
    ViewBag.Title = "巡檢保養紀錄詳情";
}
@section styles {
    <script src="/Scripts/datatable.js" defer></script>
    <script src="/Scripts/dataTable/InspectionPlanMaintain.js" defer></script>
    <script src="/Scripts/dataTable/MaintainRecord.js" defer></script>
    <script src="/Scripts/dataTable/EquipmentInfoModal.js" defer></script>
    <script src="/Scripts/ImageDisplay.js" defer></script>
}

<h2>@ViewBag.Title</h2>

<section id="MaintainRecord"></section>

<section id="InspectionPlanMaintainList"></section>

<div class="edit-button-area mb-5">
    <button class="btn btn-search" id="OtherMaintainRecord">本設備其他定期保養紀錄</button>
    <button class="btn btn-back" id="RepairRecord">本設備維修紀錄</button>
</div>

@section scripts {
    <script>

        const IPMSN = '@ViewBag.id';
        let apiUrl = '@Url.Action("ReadBody", "MaintainRecord_Management")' + `/${IPMSN}`;
        //let apiUrl = null;

        const fakeData = {
            EquipmentMaintainFormItem: {
                FormItemState: "完成",
                EMFISN: "E00003_000001_230107",
                MIName: "軸承潤滑",
                Unit: "月",
                Period: "1",
                LastTime: "2022/12/01",
                Date: "2022/01/01",
                ESN: "E00003",
            },
            InspectionPlan: {
                IPSN: "P23010401",
                IPName: "巡檢A區計畫",
                PlanDate: "2023/01/08",
                PlanState: "巡檢完成",
                Shift: "早班",
                MyName: "王大明、李泰順",
            },
            InspectionPlanMaintain: {
                MaintainState: "完成",
                MyName: "王大明",
                MaintainContent: "修復完成",
                MaintainDate: "2023/01/07 12:40:56",
                ImgPath: [
                    "/Content/img/bg.png"
                ],
            },
            MaintainSupplementaryInfo: [
                {
                    MyName: "王大明",
                    SupplementaryDate: "2023/01/10",
                    SupplementaryContent: "OOXX",
                    FilePath: ["/file/電燈故障.pdf"],
                }
            ],
            MaintainAuditInfo: [
                {
                    MyName: "陳組長",
                    AuditDate: "2023/1/12",
                    AuditResult: "審核未過",
                    AuditMemo: "未處理完善",
                    ImgPath: [
                        "/Content/img/bg.png"
                    ],
                }
            ],
            InspectionPlanList: [
                {
                    "InspectionPlan": {
                        "IPSN": "P23022203",
                        "IPName": "維修設備E00003",
                        "PlanDate": "2023/2/22",
                        "PlanState": "巡檢完成",
                        "Shift": "2",
                        "MyName": "賈皓麟、羅紹齊"
                    },
                    "InspectionPlanMaintain": {
                        "MaintainState": "審核未過",
                        "MaintainContent": "好了",
                        "MyName": "賈皓麟",
                        "MaintainDate": "2023/2/22",
                        "ImgPath": []
                    },
                    "MaintainSupplementaryInfo": [
                        {
                            "MyName": "王大明",
                            "SupplementaryDate": "2023/1/15",
                            "SupplementaryContent": "OOXX",
                            "FilePath": ["/file/電燈故障.pdf", "/file/電燈故障2.pdf"],
                        }
                    ],
                    "MaintainAuditInfo": [
                        {
                            "MyName": "陳進國",
                            "AuditDate": "2023/2/22",
                            "AuditResult": "審核未過",
                            "AuditMemo": "沒修好",
                            "ImgPath": []
                        }
                    ]
                },
            ]
        }

        function readData(url = null) {

            url == null ? onSuccess(fakeData) :
                $.ajax({
                    url: url,
                    type: "GET",
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    success: onSuccess,
                    error: onError
                })

            function onSuccess(res) {
                console.log(res);
                MaintainRecord("#MaintainRecord", res);
                InspectionPlanMaintain("#InspectionPlanMaintainList", res.InspectionPlanList);

                ImageDisplay(".datatable-img-item>img");
            }
            function onError(res) {
                console.log(res);
            }
        }

        window.onload = function () {
            readData(apiUrl);
        }

    </script>
}