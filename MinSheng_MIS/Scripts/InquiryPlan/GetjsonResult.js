const QuotationItem =
    [
        {
            "MFRName": "廠商1",
            "QSN": "",
            "ItemObject": [
                {
                    "ItemName": "藥劑-1",
                    "Brand": "1",
                    "Model": "11",
                    "Amount": 5,
                    "Packaging": "250g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單.pdf"
                },
                {
                    "ItemName": "藥劑-2",
                    "Brand": "1-1",
                    "Model": "11-1",
                    "Amount": 10,
                    "Packaging": "150g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單2.pdf"
                }
            ]
        },
        {
            "MFRName": "廠商2",
            "QSN": "",
            "ItemObject": [
                {
                    "ItemName": "藥劑-1",
                    "Brand": "2",
                    "Model": "22",
                    "Amount": 12,
                    "Packaging": "100g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單3.pdf"
                },
                {
                    "ItemName": "藥劑-2",
                    "Brand": "2-1",
                    "Model": "22-1",
                    "Amount": 10,
                    "Packaging": "110g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單4.pdf"
                }
            ]
        },
        {
            "MFRName": "廠商3",
            "QSN": "",
            "ItemObject": [
                {
                    "ItemName": "藥劑-1",
                    "Brand": "3",
                    "Model": "33",
                    "Amount": 14,
                    "Packaging": "200g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單5.pdf"
                },
                {
                    "ItemName": "藥劑-2",
                    "Brand": "3-1",
                    "Model": "33-1",
                    "Amount": 10,
                    "Packaging": "240g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單6.pdf"
                }
            ]
        },
        {
            "MFRName": "廠商4",
            "QSN": "",
            "ItemObject": [
                {
                    "ItemName": "藥劑-1",
                    "Brand": "4",
                    "Model": "44",
                    "Amount": 20,
                    "Packaging": "220g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單7.pdf"
                },
                {
                    "ItemName": "藥劑-2",
                    "Brand": "4-1",
                    "Model": "44-1",
                    "Amount": 10,
                    "Packaging": "230g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單8.pdf"
                }
            ]
        },
        {
            "MFRName": "廠商4",
            "QSN": "",
            "ItemObject": [
                {
                    "ItemName": "藥劑-1",
                    "Brand": "4",
                    "Model": "44",
                    "Amount": 20,
                    "Packaging": "220g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單7.pdf"
                },
                {
                    "ItemName": "藥劑-2",
                    "Brand": "4-1",
                    "Model": "44-1",
                    "Amount": 10,
                    "Packaging": "230g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單8.pdf"
                }
            ]
        },
        {
            "MFRName": "廠商4",
            "QSN": "",
            "ItemObject": [
                {
                    "ItemName": "藥劑-1",
                    "Brand": "4",
                    "Model": "44",
                    "Amount": 20,
                    "Packaging": "220g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單7.pdf"
                },
                {
                    "ItemName": "藥劑-2",
                    "Brand": "4-1",
                    "Model": "44-1",
                    "Amount": 10,
                    "Packaging": "230g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單8.pdf"
                }
            ]
        },
        {
            "MFRName": "廠商4",
            "QSN": "",
            "ItemObject": [
                {
                    "ItemName": "藥劑-1",
                    "Brand": "4",
                    "Model": "44",
                    "Amount": 20,
                    "Packaging": "220g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單7.pdf"
                },
                {
                    "ItemName": "藥劑-2",
                    "Brand": "4-1",
                    "Model": "44-1",
                    "Amount": 10,
                    "Packaging": "230g/罐",
                    "SubTotal": "12,000",
                    "ExcludeTaxTotal": "22,000",
                    "DeliveryLocation": "2023/03/15",
                    "QuotationFile": "報價單8.pdf"
                }
            ]
        }
    ]

function getJSONresult(url = null) {
    
        url == null ? onSuccess(QuotationItem) :  
            $.ajax({
                url: url,
                data: JSON.stringify(jsonData),
                type: "POST",
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: onSuccess,
                error: onError
            })

    async function onSuccess(res) {
        console.log("res:",res);

        
        ItemsObject()
        res.forEach((d, i) => {
            let MFRNames = `<td class="datatable-table-td" id="MFRName_${i}">${d.MFRName}</td>`
            let QSNs =
                `<td class="datatable-table-td" id="">
                    <div>
                        <button type="button" class="btn btn-datagrid">編輯</button>
                        <button type="button" class="btn btn-datagrid">詳情</button>
                    </div>
                </td>`
            $("#MFRName_Place").append(MFRNames);
            $("#QSN_Place").append(QSNs);

            res.forEach((e, k) => {
                let input =
                    `<td>
                    <div class="d-flex flex-column" style="gap:0.75rem;">
                        <input class="form-control" id="Brand_${i}_${k}" name="Brand_${i}_${k}" type="text" />
                        <input class="form-control" id="Model_${i}_${k}" name="Model_${i}_${k}" type="text" />
                        <input class="form-control" id="Amount_${i}_${k}" name="Amount_${i}_${k}" type="text" />
                        <input class="form-control" id="Packaging_${i}_${k}" name="Packaging_${i}_${k}" type="text" />
                        <input class="form-control" id="SubTotal_${i}_${k}" name="SubTotal_${i}_${k}" type="text" />
                    </div>
                </td>
                `
                $(`#ItemName_Place_${i}`).append(input)

                e.ItemObject.forEach((item, a) => {

                    $(`#Brand_${i}_${k}`).val(item.Brand);
                    $(`#Model_${i}_${k}`).val(item.Model);
                    $(`#Amount_${i}_${k}`).val(item.Amount);
                    $(`#Packaging_${i}_${k}`).val(item.Packaging);
                    $(`#SubTotal_${i}_${k}`).val(item.SubTotal);
                })     
            })
            
            let ExcludeTaxTotals =
                `<td class="datatable-table-td" id="">
                    <input class="form-control" id="ExcludeTaxTotal_${i}" name="" type="text" />
                </td>`

            $("#ExcludeTaxTotal_Place").append(ExcludeTaxTotals);
            

            let DeliveryLocations =
                `<td class="datatable-table-td" id="">
                    <input class="form-control" id="DeliveryLocation_${i}" name="" type="text" />
                </td>`
            $("#DeliveryLocation_Place").append(DeliveryLocations);

               


            let QuotationFiles =
                `<td class="datatable-table-td" id="">
                    <div class="edit-button-area justify-content-center align-items-center mt-1 flex-wrap flex-column-reverse flex-lg-nowrap gap-0">
                        <div class="d-lg-contents d-flex w-100" style="gap: 14px;">
                            <label for="QuotationFile_${i}" type="button" class="btn btn-datagrid w-lg-auto w-100 h-100 mt-0 flex-shrink-0">
                                檔案上傳
                            </label>
                        </div>
                        <div id="ImgPathGroup_${i}"
                            class="order-first order-lg-last d-flex align-items-center text-start text-light w-100 w-lg-auto d-none">
                            <div id="ImgPathName_${i}" class="d-inline-block text-break me-2" style="margin: 0.375rem;color:#44BCC2"></div>
                            <button type="button" class="btn-delete-item flex-shrink-0" id="ImgPathDelete_${i}"></button>
                        </div>
                    </div>
                    <input id="QuotationFile_${i}" name="QuotationFile_${i}" type="file" class="form-file-input" required>
                </td>
                `
            $("#QuotationFile_Place").append(QuotationFiles);

            d.ItemObject.forEach((n, a) => {
                console.log(n.QuotationFile)
                $(`#ExcludeTaxTotal_${i}`).val(n.ExcludeTaxTotal);
                $(`#DeliveryLocation_${i}`).val(n.DeliveryLocation);

                if (n.QuotationFile != "" && n.QuotationFile != null) {
                    $(`#ImgPathGroup_${i}`).removeClass('d-none');
                    $(`#ImgPathName_${i}`).html(n.QuotationFile);
                }
            })  

            $(`#QuotationFile_${i}`).change(function (e) {
                console.log(this.files);
                if (this.files && this.files.length !== 0) {
                    let file = this.files[0];
                    $(`#ImgPathName_${i}`).text(file.name);
                    $(`#ImgPathGroup_${i}`).removeClass('d-none');
                }
            })

            $(`#ImgPathDelete_${i}`).click(function () {
                $(`#QuotationFile_${i}`).val('');
                $(`#ImgPathName_${i}`).text('');
                $(`#ImgPathGroup_${i}`).addClass('d-none');
            })
            
        })
    }
        function onError(res) {
            console.log(res);
        }
}

function ItemsObject() {

    fakeData.InquiryItem.forEach((f, i) => {
        console.log("fakeData:", fakeData);
        let ItemNames =
            `<tr id="ItemName_Place_${i}">
                <td class="datatable-table-th p-0" style="background-color: #c6e1ff;">
                    <div class="d-flex col-12 align-items-center">
                        <div class="col-7">${f.ItemName}</div>
                        <div class="col d-flex flex-column inquiryInfo" style="background-color: #d3e8ff;">
                            <span>廠牌</span>
                            <span>型號</span>
                            <span>數量</span>
                            <span>包裝形式</span>
                            <span>價格</span>
                        </div>
                    </div>
                </td>
            </tr>`
        $(ItemNames).insertBefore('#ExcludeTaxTotal_Place');

    })
}




